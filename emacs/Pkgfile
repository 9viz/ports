# Name: emacs
# Description: GNU Emacs
# Depends on: gtk3 libpng

name=emacs
version=26.2
release=2
source=(http://mirrors.syringanetworks.net/gnu/$name/$name-$version.tar.xz
    change_emacs_directory.diff)

build() {
    cd $name-$version
    patch -p1 < $SRC/change_emacs_directory.diff
    ./configure --prefix=/usr \
	--libexecdir=/usr/lib \
        --sysconfdir=/usr/etc \
        --with-x-toolkit=gtk3 \
        --with-sound=no \
        --with-xft \
        --without-{gsettings,selinux,gpm,libsystemd,gif,tiff,gnutls,imagemagick} \
        --with-x \
	--disable-nls
    make
    make DESTDIR=$PKG install

    rm $PKG/usr/bin/$name
    mv $PKG/usr/bin/$name-$version $PKG/usr/bin/$name
    rm $PKG/usr/bin/{ebrowse,etags}
    rm -r $PKG/usr/share/{applications,info,icons,metainfo}
    rm $PKG/usr/share/man/man1/{ebrowse,etags}.1.gz

    # Thank You Alan
    find $PKG -name '*README*' -delete
    find $PNG -name '*NEWS*' -delete
    find $PKG -name COPYING -delete
    find $PKG/usr/share/$name/$version/etc -name '[A-Z]' ! -name '*.map' ! -name '*.el' ! -name '*.xml' ! -name Makefile ! -name 'TUTORIAL*' -delete
}
